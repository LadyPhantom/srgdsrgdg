<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <!--<div th:replace="fragments/layout :: header-css">-->
    <!--</div>-->

    <!--<style>

        #header{
            background-color: #18282f;
        }

        .ui.footer.segment {
            position: fixed;
            bottom: 0;
            width: 100%;
            margin-bottom: 0;
            background-color: #18282f;
        }

        /* Changer semantic ui color config'?*/
        .ui.inverted.menu .item{
            background-color: #f6cf41;
        }

        .ui.inverted.menu a.item:hover{
            background-color: black;
        }

        .main{
            background-color: #fbfbfb;
        }

    </style>-->

    <div th:replace="fragments/header :: header-css"></div>

</head>
<body class="site">
<div th:replace="fragments/header :: header-page"></div>


<!-- /////////////////// Main /////////////////////-->
<div class="main ui container site-content" th:object="${film}">
    <div class="ui grid container grey-bg" > <!--  Grid  -->


        <div class="centered row">
                <h1 class="ui header">Modification film</h1>
        </div>


        <!-- /////////////////// Détails film /////////////////////-->
        <div class="row">

            <div class="sixteen wide column">

                <h2 class="ui dividing header">Fiche signalétique</h2>
                <!-- ....................................... -->

                <div class="ui grid">
                    <div class="centered fourteen wide column" >
                        <div class="ui two column grid">

                            <div class="five wide column">
                                <!-- 1ere colone : image -->
                                <img src="http://fr.web.img4.acsta.net/r_1920_1080/pictures/15/10/18/18/56/052074.jpg"
                                     th:src="@{'/img/poster/film/'+${film.id}}"
                                     class="ui medium image">
                            </div>


                            <div class="eleven wide column">
                                <div class="row">

                                    <form class="ui form">

                                        <div class="field">
                                            <input th:field="${film.id}" type="hidden">
                                            <input th:field="${film.imagePath}" type="hidden">
                                        </div>

                                        <div class="field">
                                            <label>Titre</label>
                                            <input th:field="${film.title}" type="text">
                                        </div>

                                        <div class="field">
                                            <label>Notation</label>
                                            <input th:field="*{rating}" type="number">
                                        </div>

                                        <div class="field">
                                            <label>Date de sortie</label>
                                            <input th:field="*{releaseDate}" type="date">
                                        </div>

                                        <div class="field">
                                            <label>Réalisateur</label>
                                            <select th:field="${film.director}" class="ui search dropdown">
                                                <option
                                                        th:each="person: ${persons}"
                                                        th:text="${person.givenname}+' '+${person.surname}"
                                                        th:value="${person.id}"
                                                >
                                                    Prénom Nom
                                                </option>
                                            </select>
                                        </div>

                                    </form>

                                </div>
                            </div>


                            <div class="sixteen wide column">

                                <!-- ////// résumé et genres ////// -->
                                <div class="row">

                                    <form class="ui form" id="bottom-form-film">

                                        <div class="field">
                                            <label>Résumé</label>
                                            <textarea form="bottom-form-film" rows="5" th:field="*{summary}" onchange="onChangeOfSummary()"></textarea>
                                        </div>

                                        <div class="field">

                                            <label>Genres</label>
                                            <select class="ui fluid dropdown" multiple="" th:field="*{genres}" id="selectedId"
                                                    th:onchange="'onChangeOfGenre('+ ${film.id} +')'">
                                                <option
                                                        th:each="genre: ${genresFilm}"
                                                        th:text="${genre.name}"
                                                        th:value="${genre.id}"
                                                >
                                                    Drame
                                                </option>
                                            </select>

                                        </div>

                                    </form>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- /////////////////// Roles /////////////////////-->
        <div class="row" id="casting-block">

            <div class="sixteen wide column">
                <h2 class="ui dividing header">Casting</h2>
                <!-- ....................................... -->

                <div class="ui centered grid">
                    <div class="row">
                        <div class="fourteen wide column">

                            <table class="ui selectable celled table">
                                <thead>
                                <tr>
                                    <th>Acteur</th>
                                    <th>Role</th>
                                    <th>Rang</th>
                                </tr>
                                </thead>
                                <tbody id="genre-body">
                                <tr id="row-role-template">
                                    <td id="actor-role-template">un acteur</td>
                                    <td id="name-role-template">un role</td>
                                    <td id="rank-role-template">un rank</td>
                                </tr>
                                <tr th:each="role: ${film.roles}" th:id="'row-role'+${role.id}"
                                    th:onclick="'openDialogMod(' + ${role.id}+')'">
                                    <td th:text="${role.actor.surname} + ' ' + ${role.actor.givenname}"
                                        th:id="'actor-role'+ ${role.id}">actor
                                    </td>
                                    <td th:text="${role.name}" th:id="'name-role'+ ${role.id}">role</td>
                                    <td th:text="${role.rank}" th:id="'rank-role'+ ${role.id}">rank</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="row">
                            <div class="ui button" onclick="openDialogAdd()">
                                Ajouter un role
                            </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="ui hidden section divider"></div>
    <div class="ui centered grid">
        <div class="row">

            <div class="ui primary button" onclick="saveAll()">
                Valider
            </div>

        </div>
    </div>

</div>


<!-- ////////////////// Footer //////////////////-->
<div th:replace="fragments/footer :: footer-js"></div>
<div th:replace="fragments/footer :: footer-sticky"></div>

<script type="application/javascript">
    $('#menu-films').addClass("active");
    $('.ui.dropdown').dropdown();

    $('#row-role-template').hide();

    $(document).ready(function () {
        tinymce.init({
            selector: '#summary',
            setup:function(ed) {
                ed.on('blur', function (e) {
onChangeOfSummary();
                });
            }
        });
    })

    function validFilm() {
        var idFilm = $('#id').val();
        // var director = {
        // "id" : $("#director option:selected").val(),
        // "surname" : $("#director option:selected").text().split(" ").pop()
        // }
        //$("option:selected").val()
        //
        //
        // console.log(director.id);
        // console.log(director.surname);

        var film = {
            "id" : idFilm,
            "title" : $('#filmTitle') + idFilm ,
            "rating" : $('#rating').val()
        };

        /*
        * ,
            "image_path" : $('#imagePath').val() ,
            "summary" : $('#summary').val() ,
            "releaseDate" : $('#releaseDate').val()
        * */

        // "director" :
        //     {
        //         "id" : $("#director option:selected").val(),
        //         "surname" : $("#director option:selected").text().split(" ").pop()
        //     }

        // console.log(film.director.surname);

        //"{ \"id\" : $("#director option:selected").val() ,\"surname\" : $("#director option:selected").text().split(" ").pop()}"

        $.ajax({
            url: '/api/film',
            type: 'put',
            dataType: 'json',
            contentType: 'application/json',
            success: onSuccessUpdateFilm,
            error: onErrorOnFilmApi,
            data: JSON.stringify(film)
        });
    }

    function onSuccessUpdateFilm() {

    }

    function onErrorOnFilmApi() {

    }

    function onChangeOfGenre(filmId){

        var newGenres = $('#selectedId').val();

        console.log( $('input[name=title]').val() + " (id="+ filmId + ") :\n \t genres: "
            + $('#selectedId').val() );

    }
    function onChangeOfSummary(){
        console.log("change in summary");

        console.log(

            tinymce.get('summary').getContent()
            // $( tinymce.get('summary').getContent() ).text()

        );
    }

    </script>

</body>
</html>